{% extends "base.html" %}

{% block title %}Solar{% endblock %}

{% block scripts %}
<script type="text/javascript">

function disable_unused_locations() {
	button_lookup = {
		"#loc_choice_cs"  : ["#id_city", "#id_state"], 
		"#loc_choice_zip" : ["#id_zip_code"],
		"#loc_choice_ll"  : ["#id_latitude", "#id_longitude"]
		}
	
	for (var radio_button in button_lookup) {
		for (i in button_lookup[radio_button]) {
			if ($(radio_button).is(":checked") == true) 
				$(button_lookup[radio_button][i]).removeAttr("disabled")
			else
				$(button_lookup[radio_button][i]).attr("disabled", true)
		}
	}
}

$(document).ready(function(){
	// Disable unused location configuration options
	disable_unused_locations()
	
	// Update when one is selected
	$('#loc_config').find(':radio').change(function(event){
		disable_unused_locations()
	})
	
	// Hide power bill input table if its not being used
	if ($("#costs_choice_spec").is(":checked") == false)
		$("#power_bill").hide()
	
	// Toggle on the input table if necessary
	$("#costs_choice_avg").change(function(event){
		$("#power_bill").slideUp("slow")
	});
	$("#costs_choice_spec").change(function(event){
		$("#power_bill").slideDown("slow")
	});
	
	
	// livevalidation stuff... goes here?
	var id_peak_power_output = new LiveValidation('id_peak_power_output',{ validMessage: "✓", wait: 500 });
	id_peak_power_output.add( Validate.Numericality);
	id_peak_power_output.add( Validate.Presence, { failureMessage: "x" } );

	var id_installation_price = new LiveValidation('id_installation_price',{ validMessage: "✓", wait: 500 });
	id_installation_price.add( Validate.Numericality);
	id_installation_price.add( Validate.Presence, { failureMessage: "x" } );
	
	var id_zip_code = new LiveValidation('id_zip_code',{ validMessage: "✓", wait: 500 });
	id_zip_code.add( Validate.Numericality, { minimum: 0, maximum: 99999, failureMessage: "x"});
	id_zip_code.add( Validate.Presence, { failureMessage: "x" } );
	
	var id_latitude = new LiveValidation('id_latitude',{ validMessage: "✓", wait: 500 });
	id_latitude.add( Validate.Numericality, { minimum: -360, maximum: 360, failureMessage: "x"});
	id_latitude.add( Validate.Presence, { failureMessage: "x" } );
	
	var id_longitude = new LiveValidation('id_longitude',{ validMessage: "✓", wait: 500 });
	id_longitude.add( Validate.Numericality, { minimum: -360, maximum: 360, failureMessage: "x"});
	id_longitude.add( Validate.Presence, { failureMessage: "x" } );
});    
</script>
{% endblock %}

{% block content %}
<form action="/calc_payback/" method="POST">
	<h2><b>Solar 2009</b> - Solar panel installation planner
	<h3>Configure Solar Panels</h3>
	<div>
		<table id="system_config">
		{{ system_form.as_table }}
		</table>
	</div>

	<h3>Configure Location</h3>
	<div>
		<table id="loc_config">
			<tr> <td colspan="3">We need to know where are you to provide accurate estimates. Please select one of these options for determining your location and fill in the corresponding field.</td> </tr>
			<tr>
				<th><input id="loc_choice_cs" type="radio" name="loc_choice" value="city_state" {% ifequal loc_choice "city_state" %} checked {% endifequal %}></th>
				<td>City/State: {{ location_form.city}} {{ location_form.state}}</td>
			</tr>
			<tr>
				<th><input id="loc_choice_zip" type="radio" name="loc_choice" value="zip_code" {% ifequal loc_choice "zip_code" %} checked {% endifequal %} ></th>
				<td>ZIP: {{ location_form.zip_code}}</td>
			</tr>
			<tr>
				<th><input id="loc_choice_ll" type="radio" name="loc_choice" value="lat_lng" {% ifequal loc_choice "lat_lng" %} checked {% endifequal %}></th>
				<td>Coordinates: <span class="lat_long">Lat:</span> {{location_form.latitude}} <span class="lat_long">Long:</span> {{ location_form.longitude}}</td>
			</tr>
		</table>
	</div>

	<h3>Configure Costs and Pricing</h3>
	<div>
		<table id="cost_config">
			<tr> <td colspan="3"> We can either use averages for power costs and usage in your area, or your own power bill data. </td> </tr>
			<tr>
				<th><input id="costs_choice_avg" type="radio" name="costs_choice" value="averages" {% ifequal costs_choice "averages" %} checked {% endifequal %}></th>
				<td>Use location averages for pricing (less accurate)</td>
			</tr>
			<tr>
				<th><input id="costs_choice_spec" type="radio" name="costs_choice" value="specified" {% ifequal costs_choice "specified" %} checked {% endifequal %}></th>
				<td>Input your own power bill data for the last year</td>
			</tr>
		</table>
		<table id="power_bill">
			<tr>
				<th>Month</th>
				<th>Bill that month ($)</th>
				<th>Energy used (KWh) </th>
			</tr>
			<tr>
				<td>January</td>
				<td>{{costs_form.jan_bill}}</td>
				<td>{{costs_form.jan_usage}}</td>
			</tr>
			<tr>
				<td>February</td>
				<td>{{costs_form.feb_bill}}</td>
				<td>{{costs_form.feb_usage}}</td>
			</tr>
			<tr>
				<td>March</td>
				<td>{{costs_form.mar_bill}}</td>
				<td>{{costs_form.mar_usage}}</td>
			</tr>
			<tr>
				<td>April</td>
				<td>{{costs_form.apr_bill}}</td>
				<td>{{costs_form.apr_usage}}</td>
			</tr>
			<tr>
				<td>May</td>
				<td>{{costs_form.may_bill}}</td>
				<td>{{costs_form.may_usage}}</td>
			</tr>
			<tr>
				<td>June</td>
				<td>{{costs_form.jun_bill}}</td>
				<td>{{costs_form.jun_usage}}</td>
			</tr>
			<tr>
				<td>July</td>
				<td>{{costs_form.jul_bill}}</td>
				<td>{{costs_form.jul_usage}}</td>
			</tr>
			<tr>
				<td>August</td>
				<td>{{costs_form.aug_bill}}</td>
				<td>{{costs_form.aug_usage}}</td>
			</tr>
			<tr>
				<td>September</td>
				<td>{{costs_form.sep_bill}}</td>
				<td>{{costs_form.sep_usage}}</td>
			</tr>
			<tr>
				<td>October</td>
				<td>{{costs_form.oct_bill}}</td>
				<td>{{costs_form.oct_usage}}</td>
			</tr>
			<tr>
				<td>November</td>
				<td>{{costs_form.nov_bill}}</td>
				<td>{{costs_form.nov_usage}}</td>
			</tr>
			<tr>
				<td>December</td>
				<td>{{costs_form.dec_bill}}</td>
				<td>{{costs_form.dec_usage}}</td>
			</tr>
		</table>
	</div>	

	<h3> Finalize </h3>
	<div id="finalize">
		<span style="float: left;"><input type="checkbox" name="save" {{saved_data}}/> Save my data for when I come back (cookies required)</span>
		<span style="float: right;"><input id="submit_btn" type="submit" value="Calculate!" /></span> 
		<br style="clear: both;" />
	</div>
</form>
{% endblock %}
